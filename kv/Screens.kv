#:import Factory kivy.factory.Factory

<ManagerScreen>:
    canvas:
        Color:
            rgba: WHITE_RGBA

        Rectangle:
            size: self.size
            source: BK_PATH


<LoginScreen>:
    FloatLayout:
        Image:
            size_hint: 0.3 , 0.38
            pos_hint: {"x": 0.35, "y": 0.52}
            source: LOGO_PATH

        GridLayout:
            cols: 2
            spacing: 15
            padding: 10
            size_hint: 0.5, 0.25
            pos_hint: {"x": 0.25, "y": 0.2}

            DefaultLabel:
                text: "USERNAME"
                size_hint_x: 0.37

            DefaultTextInput:
                id: user_input
                font_size_scale: 0.8
                size_hint_x: 0.63
                valign: "middle"
                halign: "center"
                focus: True

            DefaultLabel:
                text: "PASSWORD"
                size_hint_x: 0.37

            DefaultTextInput:
                id: pwd_input
                font_size_scale: 0.8
                size_hint_x: 0.63
                valign: "middle"
                halign: "center"
                multiline: False
                password: True

                on_text_validate:
                    root.login(user_input.text, pwd_input.text, True)

<MainScreen>:
    FloatLayout:
        DefaultLabel:
            text: "WALLâ‚¬T"
            size_hint: 0.4, 0.15
            pos_hint: {"x": 0.3, "y": 0.8}
            font_size_scale: 2.8

        DefaultLayout:
            size_hint: 0.25, 0.63
            pos_hint: {"x": 0.05, "y": 0.1}

            DefaultButton:
                text: "Nuovo movimento"
                font_size_scale: 1.2
                multiline: True
                background_color: LIGHTBLUE_RGBA
                border_color: DARKGREY_RGBA
                on_release:
                    root.show_movements()

            DefaultButton:
                text: "Debiti - Crediti"
                font_size_scale: 1.2
                multiline: True
                background_color: YELLOW_RGBA
                border_color: DARKGREY_RGBA
                on_release:
                    root.show_deb_cred()

            DefaultButton:
                text: "Movimenti inseriti"
                font_size_scale: 1.2
                background_color: PURPLE_RGBA
                border_color: DARKGREY_RGBA
                on_release:
                    root.show_last_movements()

            DefaultButton:
                text: "Backup DB"
                font_size_scale: 1.2
                border_color: DARKGREY_RGBA
                background_color: LIGHTGREEN_RGBA
                on_release:
                    root.backup()

            DefaultButton:
                id: button_bi
                text: "Statistics"
                font_size_scale: 1.2
                color: DARKGREY_RGBA
                border_color: DARKGREY_RGBA
                background_color: WHITE_RGBA
                on_release:
                    root.open_bi()

                canvas.after:
                    Rectangle:
                        size: self.size[0] / 4, self.size[1] / 4
                        pos: self.pos[0] + self.size[0] * 3 / 4, self.pos[1]
                        source: BI_LOGO_PATH

        ButtonDynamicInputLayout:
            id: general_mov
            size_hint: 0.4, 0.55
            pos_hint: {"x": 0.325, "y": 0.15}
            type_btn: "default"
            f_to_launch: root.set_movement
            selection_type: "single"

        DefaultLayout:
            id: deb_cred
            size_hint: 0.4, 0.225
            pos_hint: {"x": 0.325, "y": 0.315}

            DefaultButton:
                text: "Debito - Credito"
                background_color: LIGHTYELLOW_RGBA

                on_release:
                    root.manager.type_mov = self.text

            DefaultButton:
                text: "Saldo debito - credito"
                background_color: LIGHTYELLOW_RGBA

                on_release:
                    root.manager.current = "open_deb_cred"
                    root.manager.transition.direction = "up"

<InsertMovementScreen>:
    FloatLayout:
        DefaultLabel:
            text: root.name.upper()
            size_hint: 0.75, 0.18
            pos_hint: {"x": 0.125, "y": 0.81}
            font_size_scale: 1.5
            color: WHITE_RGBA
            background_color: BLUE_RGBA
            border_color: WHITE_RGBA

    DefaultButton:
        text: "Inserisci".upper()
        font_size_scale: 1.1
        size_hint: 0.2, 0.1
        pos_hint: {"x": 0.76, "y": 0.35}
        background_color: LIGHTGREEN_RGBA
        color: WHITE_RGBA
        on_release:
            root.insert_movement()

    DefaultButton:
        text: "HOME"
        font_size_scale: 1.5
        size_hint: 0.2, 0.1
        pos_hint: {"x": 0.76, "y": 0.24}
        background_color: RED_RGBA
        on_press:
            root.interrupt_insertion()


<PayOffScreen>:
    FloatLayout:
        DefaultLabel:
            text: "Debiti/crediti aperti"
            font_size_scale: 1.9
            size_hint: 0.5, 0.14
            pos_hint: {"x": 0.25, "y": 0.78}

        LabelDynamicLayout:
            id: deb_cred_columns
            orientation: "horizontal"
            font_size_chars: FONT_SIZE * 0.8
            pos_hint: {"x": 0.05, "y": 0.6}
            size_hint: 0.9, None
            height: 80

        DefaultScrollView
            pos_hint: {"x": 0.05, "y": 0.182}
            size_hint: 0.9, 0.417

            TableDynamicInputLayout:
                id: deb_cred_tab
                f_to_launch: root.add_new_id
                font_size_chars: FONT_SIZE * 0.6

        DefaultLayout:
            id: appearing_box
            orientation: "horizontal"
            size_hint: 0.45, 0.14
            pos_hint: {"x": 0.275, "y": 0.035}
            spacing: 9
            padding: 9

            DefaultButton:
                text: "Salda".upper()
                font_size_scale: 1.2
                background_color: LIGHTGREEN_RGBA
                color: DARKGREY_RGBA

                on_release:
                    root.go_to_insert_screen()

            DefaultButton:
                text: "Elimina".upper()
                font_size_scale: 1.2
                background_color: RED_RGBA
                color: WHITE_RGBA

                on_release:
                    root.remove_records()

        DefaultButton:
            text: "HOME"
            font_size_scale: 1.5
            size_hint: 0.15, 0.1
            pos_hint: {"x": 0.83, "y": 0.03}
            background_color: RED_RGBA
            on_press:
                root.manager.go_to_main_screen()


<ShowMovementsScreen>:
    FloatLayout:
        DefaultLayout:
            orientation: "horizontal"
            size_hint: 0.45, 0.1
            pos_hint: {"x": 0.01, "y": 0.89}

            DefaultLabel:
                id: info_no_rows
                markup: True
                text: "Record visualizzati [max: " + str(root.max_rows_to_show) + "]"
                size_hint_x: 0.8
                halign: "right"
                font_size_scale: 0.9

            DefaultTextInput:
                id: input_no_rows
                size_hint_x: 0.2
                font_size_scale: 0.9
                valign: "middle"
                halign: "left"
                round_int: True
                text: str(root.records_to_show)

                on_text:
                    root.set_new_number(self.text)

        ButtonDynamicInputLayout:      # list of movements to check
            id: box_movements
            size_hint: 0.2, 0.65
            pos_hint: {"x": 0.01, "y": 0.15}
            f_to_launch: root.set_movement
            font_size_chars: FONT_SIZE * 0.9
            selection_type: "single"

        LabelDynamicLayout:      # list of field names
            id: mov_columns
            orientation: "horizontal"
            pos_hint: {"x": 0.22, "y": 0.7}
            size_hint: 0.77, 0.1
            font_size_chars: FONT_SIZE * 0.6

        DefaultScrollView
            pos_hint: {"x": 0.22, "y": 0.16}
            size_hint: 0.77, 0.54

            TableDynamicInputLayout:
                id: rows_box
                font_size_chars: FONT_SIZE * 0.6
                f_to_launch: root.add_record_to_remove

        DefaultLayout:
            id: remove_record_btn
            size_hint: 0.2, 0.13
            pos_hint: {"x": 0.375, "y": 0.095}

            DefaultButton:
                text: "Elimina".upper()
                color: WHITE_RGBA
                background_color: RED_RGBA
                font_size_scale: 0.7
                on_release:
                    root.remove_records()

        DefaultButton:
            text: "HOME"
            font_size_scale: 1.5
            size_hint: 0.15, 0.1
            pos_hint: {"x": 0.83, "y": 0.03}
            background_color: RED_RGBA
            on_press:
                root.manager.go_to_main_screen(direction="down")
