#:import Factory kivy.factory.Factory

<ManagerScreen>:
    canvas:
        Color:
            rgba: 1, 1, 1, 1

        Rectangle:
            size: self.size
            source: BK_PATH


<LoginScreen>:
    FloatLayout:
        Image:
            size_hint: 0.3 , 0.38
            pos_hint: {"x": 0.35, "y": 0.52}
            source: LOGO_PATH

        GridLayout:
            cols: 2
            spacing: 10
            padding: 10
            size_hint: 0.4, 0.3
            pos_hint: {"x": 0.3, "y": 0.2}

            DefaultLabel:
                text: "USERNAME"
                size_hint_x: 0.37

            DefaultTextInput:
                id: user_input
                size_hint_x: 0.63
                valign: "middle"
                halign: "center"
                font_size: FONT_SIZE * 0.8
                focus: True

            DefaultLabel:
                text: "PASSWORD"
                size_hint_x: 0.37

            DefaultTextInput:
                id: pwd_input
                size_hint_x: 0.63
                valign: "middle"
                halign: "center"
                multiline: False
                password: True
                font_size: FONT_SIZE * 0.8

                on_text_validate:
                    root.login(user_input.text, pwd_input.text, True)


<MainScreen>:
    FloatLayout:
        DefaultLabel:
            text: "WALL€T"
            size_hint: 0.45, 0.15
            pos_hint: {"x": 0.275, "y": 0.8}
            font_size: FONT_SIZE * 2.6

        DefaultLayout:
            size_hint: 0.25, 0.63
            pos_hint: {"x": 0.05, "y": 0.1}

            DefaultButton:
                text: "Nuovo movimento"
                font_size: FONT_SIZE * 1.2
                multiline: True
                background_color: LIGHTBLUE_RGBA
                border_color: DARKGREY_RGBA
                on_release:
                    root.show_movements()

            DefaultButton:
                text: "Debiti - Crediti"
                font_size: FONT_SIZE * 1.2
                multiline: True
                background_color: YELLOW_RGBA
                border_color: DARKGREY_RGBA
                on_release:
                    root.show_deb_cred()

            DefaultButton:
                text: "Movimenti inseriti"
                font_size: FONT_SIZE * 1.2
                background_color: PURPLE_RGBA
                border_color: DARKGREY_RGBA
                on_release:
                    root.show_last_movements()

            DefaultButton:
                id: button_bi
                text: "Apri BI"
                font_size: FONT_SIZE * 1.2
                color: DARKGREY_RGBA
                border_color: DARKGREY_RGBA
                background_color: [1, 1, 1, 1]
                on_release:
                    root.open_bi()

        ButtonDynamicInputLayout:
            id: general_mov
            size_hint: 0.4, 0.55
            pos_hint: {"x": 0.325, "y": 0.15}
            type_btn: "default"
            f_to_launch: root.set_movement
            selection_type: "single"

        DefaultLayout:
            id: deb_cred
            size_hint: 0.4, 0.225
            pos_hint: {"x": 0.325, "y": 0.315}

            DefaultButton:
                text: "Debito - Credito"
                background_color: LIGHTYELLOW_RGBA

                on_release:
                    root.manager.type_mov = self.text

            DefaultButton:
                text: "Saldo debito - credito"
                background_color: LIGHTYELLOW_RGBA

                on_release:
                    root.manager.current = "open_deb_cred"
                    root.manager.transition.direction = "up"

        Image:
            source: BI_LOGO_PATH
            allow_stretch: True
            keep_ratio: False
            size_hint: 0.09, 0.0405  # il rapporto h/l è 0.45
            pos_hint: {"x": 0.2, "y": 0.11}

        DefaultButton:
            text: "BACKUP DATABASE"
            size_hint: 0.2, 0.14
            pos_hint: {"x": 0.78, "y": 0.05}
            font_size: FONT_SIZE * 0.9
            multiline: True
            background_color: CYAN_RGBA
            on_release:
                root.backup()


<InsertMovementScreen>:
    FloatLayout:
        DefaultLabel:
            text: root.name.upper()
            size_hint: 0.75, 0.18
            pos_hint: {"x": 0.125, "y": 0.81}
            font_size: FONT_SIZE * 1.35
            color: [1, 1, 1, 1]
            background_color: BLUE_RGBA
            border_color: 1, 1, 1, 1

    DefaultButton:
        text: "Inserisci".upper()
        font_size: FONT_SIZE * 1.1
        size_hint: 0.2, 0.1
        pos_hint: {"x": 0.76, "y": 0.35}
        background_color: LIGHTGREEN_RGBA
        color: 1, 1, 1, 1
        on_release:
            root.insert_movement()

    DefaultButton:
        text: "HOME"
        font_size: FONT_SIZE * 1.5
        size_hint: 0.2, 0.1
        pos_hint: {"x": 0.76, "y": 0.24}
        background_color: RED_RGBA
        on_press:
            root.interrupt_insertion()


<PayOffScreen>:
    FloatLayout:
        DefaultLabel:
            text: "Debiti/crediti da saldare"
            font_size: FONT_SIZE * 1.9
            size_hint: 0.8, 0.14
            pos_hint: {"x": 0.1, "y": 0.78}

        LabelDynamicLayout:
            id: deb_cred_columns
            orientation: "horizontal"
            pos_hint: {"x": 0.05, "y": 0.6}
            size_hint: 0.9, None
            height: 80

        DefaultScrollView
            pos_hint: {"x": 0.05, "y": 0.182}
            size_hint: 0.9, 0.417

            TableDynamicInputLayout:
                id: deb_cred_tab
                f_to_launch: root.add_new_id

        DefaultLayout:
            id: appearing_box
            orientation: "horizontal"
            size_hint: 0, 0.14
            pos_hint: {"x": 0.275, "y": 0.035}
            opacity: 0
            spacing: 9
            padding: 9

            DefaultButton:
                text: "Salda record selezionati".upper()
                font_size: FONT_SIZE * 0.7
                background_color: LIGHTGREEN_RGBA
                color: DARKGREY_RGBA

                on_release:
                    root.go_to_insert_screen()

            DefaultButton:
                text: "Elimina record selezionati".upper()
                font_size: FONT_SIZE * 0.7
                background_color: RED_RGBA
                color: 1, 1, 1, 1

                on_release:
                    root.remove_records()


        DefaultButton:
            text: "HOME"
            font_size: FONT_SIZE * 1.5
            size_hint: 0.15, 0.1
            pos_hint: {"x": 0.83, "y": 0.03}
            background_color: RED_RGBA
            on_press:
                root.manager.go_to_main_screen()


<ShowMovementsScreen>:
    FloatLayout:
        DefaultLabel:
            text: "Visualizza movimenti"
            font_size: FONT_SIZE * 1.9
            size_hint: 0.7, 0.15
            pos_hint: {"x": 0.15, "y": 0.83}

        DefaultLayout:
            orientation: "horizontal"
            size_hint: 0.64, 0.1
            pos_hint: {"x": 0.21, "y": 0.73}

            DefaultLabel:
                id: info_no_rows
                markup: True
                text: "Record da visualizzare: [color=f0f3f4]{}[/color]"
                size_hint_x: 0.7
                halign: "left"
                font_size: FONT_SIZE * 0.8

            DefaultLabel:
                text: "MODIFICA"
                font_size: FONT_SIZE * 0.7
                size_hint_x: 0.2
                halign: "right"

            DefaultTextInput:
                id: input_no_rows
                size_hint_x: 0.1
                font_size: FONT_SIZE * 0.7
                valign: "middle"
                round_int: True

                on_text:
                    root.set_new_number(self.text)

        ButtonDynamicInputLayout:      # list of movements to check
            id: box_movements
            size_hint: 0.2, 0.55
            pos_hint: {"x": 0.01, "y": 0.18}
            f_to_launch: root.set_movement
            font_size_chars: FONT_SIZE * 0.6
            selection_type: "single"

        DefaultButton:
            id: remove_record_btn
            text: "Elimina record selezionati".upper()
            size_hint: 0, 0.13
            pos_hint: {"x": 0.01, "y": 0.01}
            color: 1, 1, 1, 1
            opacity: 0
            background_color: RED_RGBA
            font_size: FONT_SIZE * 0.7
            on_release:
                root.remove_records()

        LabelDynamicLayout:      # list of field names
            id: mov_columns
            orientation: "horizontal"
            pos_hint: {"x": 0.22, "y": 0.62}
            size_hint: 0.77, 0.11
            font_size_chars: FONT_SIZE * 0.8

        DefaultScrollView
            pos_hint: {"x": 0.22, "y": 0.198}
            size_hint: 0.77, 0.417

            TableDynamicInputLayout:
                id: rows_box
                f_to_launch: root.add_record_to_remove

        DefaultButton:
            text: "HOME"
            font_size: FONT_SIZE * 1.5
            size_hint: 0.15, 0.1
            pos_hint: {"x": 0.83, "y": 0.03}
            background_color: RED_RGBA
            on_press:
                root.manager.go_to_main_screen(direction="down")
